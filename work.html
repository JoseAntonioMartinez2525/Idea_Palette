<html>

<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script src="./js/rect.js"></script>
  <script src="./js/linea.js"></script>
  <link rel="stylesheet" href="./css/main.css">

  <style>
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
      padding-top: 5%;
    }

    canvas {
      border: 1px solid black;
    }
  </style>
</head>

<body>
  <div class="mr-4">
    <ul id="option-list">
      <li class="list-group-item">
        <button onclick="selectTool('rect')">
          <img src="img/software-shape-rectangle_98272.png" id="rect-tool">
          Rectángulo
        </button>
      </li>
      <li class="list-group-item">
        <button onclick="selectTool('circle')">
          <img src="img/ellipse_icon-icons.com_54003.png">Ellipse
        </button>
      </li>
      <li class="list-group-item">
        <button onclick="selectTool('line')">
          <img src="img/straight-horizontal-line_icon-icons.com_74237.png" id="line-tool">Línea
        </button>
      </li>
      <li class="list-group-item">
        <button>
          <input type="checkbox" id="fill-color" onchange="generarTexto()"><label for="fill-color">Relleno</label>
        </button>
      </li>
      <li class="list-group-item">
        <button>
          <img src="img/rename_inputtext_thetext_1544.png">Fuente
        </button>
      </li>
      <li class="list-group-item">
        <button>
          <img src="img/1491254405-plusaddmoredetail_82972.png" id="nuevo">Nueva
        </button>
      </li>
      <li class="list-group-item">
        <button>
          <img src="img/save.png">Guardar
        </button>
      </li>
    </ul>
  </div>
  <div id="textoGenerado"></div>

  <script>
    let startX, startY;
    let endX, endY;
    let dragging = false;
    let selectedTool;
    let rectanglesArray = [];
    let linesArray = []; // Array para almacenar las líneas dibujadas
    let newFiguresArray = []; 
    let selectedColor = 0;

    function selectTool(tool) {
      selectedTool = tool;
    }

    function setup() {
      createCanvas(1100, 400);
      originalBackgroundColor = color(220);

      let rectTool = document.getElementById("rect-tool");
      rectTool.addEventListener("click", function () {
        selectTool('rect');
      });

      let lineTool = document.getElementById("line-tool");
      lineTool.addEventListener("click", function () {
        selectTool('line');
      });
    }

  function draw() {
    background(220);

    // Dibujar las líneas
    for (let line of linesArray) {
      line.display();
    }

    // Dibujar las figuras rectangulares
    for (let rect of rectanglesArray) {
      rect.display();
    }

    // Dibujar las nuevas figuras
    for (let newFigure of newFiguresArray) {
      newFigure.display();
    }

    // Dibujar la línea actual si se está arrastrando
    if (dragging && selectedTool === "line") {
      stroke(0);
      line(startX, startY, mouseX, mouseY);
    }

    // Dibujar el rectángulo actual si se está arrastrando
    if (dragging && selectedTool === "rect") {
      noFill();
      stroke(0);
      rect(startX, startY, mouseX - startX, mouseY - startY);
    }
  }

  function mouseReleased() {
    // ...

    if (selectedTool === "rect") {
      let width = endX - startX;
      let height = endY - startY;

      if (width !== 0 && height !== 0) {
        let newRect = new CustomRectangle(startX, startY, width, height, selectedColor);
        newFiguresArray.push(newRect);
      }
    }

    if (selectedTool === "line") {
      let newLine = new CustomLine(startX, startY, endX, endY, selectedColor);
      newFiguresArray.push(newLine);
    }
  }


    function mousePressed() {
      startX = mouseX;
      startY = mouseY;
      dragging = true;
    }

    function mouseReleased() {
      endX = mouseX;
      endY = mouseY;
      dragging = false;

      if (selectedTool === "rect") {
        let width = endX - startX;
        let height = endY - startY;

        if (width !== 0 && height !== 0) {
          let newRect = new CustomRectangle(startX, startY, width, height, selectedColor);
          rectanglesArray.push(newRect);
        }
      }

      if (selectedTool === "line") {
        let newLine = new CustomLine(startX, startY, endX, endY, selectedColor);
        linesArray.push(newLine);
      }
    }

    function generarTexto() {
      var checkbox = document.getElementById("fill-color");
      var elemento = document.getElementById("textoGenerado");

      if (checkbox.checked) {
        var labelColor = document.createElement("label");
        labelColor.textContent = "Escoge el Color ";

        var inputColor = document.createElement("input");
        inputColor.type = "color";

        labelColor.style.marginRight = "10px";

        inputColor.addEventListener("input", function () {
          selectedColor = inputColor.value;
          updateStrokeColor();
        });

        elemento.appendChild(labelColor);
        elemento.appendChild(inputColor);
      } else {
        elemento.innerHTML = "";
        selectedColor = 0;
        updateStrokeColor();
      }
    }

    function updateStrokeColor() {
      for (let rect of rectanglesArray) {
        if (selectedColor === 0) {
          rect.setStrokeColor(originalBackgroundColor);
        } else {
          rect.setStrokeColor(selectedColor);
        }
      }
    }

    // Iniciar la aplicación p5.js
    new p5();
  </script>
</body>

</html>
